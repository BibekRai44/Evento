<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Evento">
    <meta name="author" content="Evento">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <title>Post Event</title>
    <style>
        .btn-outline-primary:hover {
            color: #007bff;
            background-color: transparent;
            border-color: #007bff;
        }
        body {
  font: 16px;
  background: #f3f5f6;
}

.autocomplete-container {
  
  position: relative;
  
  margin-bottom: 20px;
}

.autocomplete-container input {
  width: calc(100% - 43px);
  outline: none;
  border: 1px solid rgba(0, 0, 0, 0.2);
  padding: 10px;
  padding-right: 31px;
  font-size: 16px;
}

.autocomplete-items {
  position: absolute;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0px 2px 10px 2px rgba(0, 0, 0, 0.1);
  border-top: none;
  z-index: 99;
  top: calc(100% + 2px);
  left: 0;
  right: 0;
  
  background-color: #fff;
}

.autocomplete-items div {
  padding: 10px;
  cursor: pointer;
}

.autocomplete-items div:hover {
  background-color: rgba(0, 0, 0, 0.1);
}

.autocomplete-items .autocomplete-active {
  background-color: rgba(0, 0, 0, 0.1);
}

.clear-button {
  color: rgba(0, 0, 0, 0.4);
  cursor: pointer;
  
  position: absolute;
  right: 5px;
  top: 0;

  height: 100%;
  display: none;
  align-items: center;
}

.clear-button.visible {
  display: flex;
}


.clear-button:hover {
  color: rgba(0, 0, 0, 0.6);
}
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container">
            <a class="navbar-brand" href="{{url_for('dashboard')}}">
                <img src="/static/logo/png/logo-no-background.png" height="40px" width="auto">
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item mr-3">
                        <a href="{{url_for('dashboard')}}">
                            <button class="btn btn-outline-primary">Home</button>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="{{url_for('logout')}}">
                            <button class="btn btn-outline-primary">Logout</button>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="container mt-5">
        <h2>Post an Event</h2>
        <form  method="POST" action="/post_event" enctype="multipart/form-data">
            {{ form.csrf_token }}
            <div class="form-group">
                <label for="eventName">Event Name<span class="text-danger">*</span></label>
                <input type="text" class="form-control" name="eventname" id="eventName" placeholder="Enter event name" required>
            </div>
            <div class="form-group"> 
                <label for="eventLocation">Location<span class="text-danger">*</span></label>
                <input type="text" class="form-control" name="location" id="eventLocation" placeholder="Enter event location" required>
                <small id="emailHelp" class="form-text text-muted">Enter plain text or a link</small>
            </div>
            <div class="autocomplete-container" id="autocomplete-container"></div>
            <div class="form-group">
                <label for="eventOrganizer">Organized By<span class="text-danger">*</span></label>
                <input type="text" class="form-control" name="organizer" id="eventOrganizer" required>
                <small id="emailHelp" class="form-text text-muted">Enter plain text or a link</small>
            </div>
            <div class="form-group">
                <label for="eventContactOrganizer">Contact Organizer<span class="text-danger">*</span></label>
                <input type="text" class="form-control" name="contactorganizer" id="eventContactOrganizer" required >
                <small id="emailHelp" class="form-text text-muted">Enter plain text or a link</small>
            </div>
            <div class="form-group">
                <label for="eventDate">Date<span class="text-danger">*</span></label>
                <input type="date" class="form-control" name="date" id="eventDate" placeholder="YYYY-MM-DD" required>
            </div>
            <div class="form-group">
                <label for="eventDuration">Duration<span class="text-danger">*</span></label>
                <input type="text" class="form-control" name="duration" id="eventDuration" placeholder="Enter event duration" required>
            </div>
            <div class="form-group">
                <label for="eventTime">Time<span class="text-danger">*</span></label>
                <input type="time" class="form-control" name="time" id="eventTime" required>
            </div>
            <div class="form-group">
                <label for="eventImage">Event Image<span class="text-danger">*</span></label>
                <input type="file" class="form-control-file" name="image" id="eventImage" accept="image/*" required>
            </div>
            <div class="form-group">
                <label for="eventDescription">Description</label>
                <textarea class="form-control" id="eventDescription" name="description" rows="3" minlength="10" maxlength="9999"></textarea>
            </div>
            <button type="submit" class="btn btn-outline-primary">Post</button>
        </form>
    </div>
    <!-- Bootstrap JS and dependencies (optional, if needed) -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>
        document.getElementById('eventDate').min = new Date().toISOString().split("T")[0];
    </script>
    <script>
        document.getElementById('eventContactOrganizer').addEventListener('input', function() {
            var input = this.value.trim();
            if (/^\d{10}$/.test(input)) {
                this.maxLength = 10;
                this.setCustomValidity('');
            } else {
                this.maxLength = 100;
                this.setCustomValidity('');
            }
        });
        function addressAutocomplete(containerElement, callback, options) {
  var inputElement = document.createElement("input");
  inputElement.setAttribute("type", "text");
  inputElement.setAttribute("placeholder", options.placeholder);
  containerElement.appendChild(inputElement);

  var clearButton = document.createElement("div");
  clearButton.classList.add("clear-button");
  addIcon(clearButton);
  clearButton.addEventListener("click", (e) => {
    e.stopPropagation();
    inputElement.value = '';
    callback(null);
    clearButton.classList.remove("visible");
    closeDropDownList();
  });
  containerElement.appendChild(clearButton);
  var currentItems;
  var currentPromiseReject;
  var focusedItemIndex;

  inputElement.addEventListener("input", function(e) {
    var currentValue = this.value;

    closeDropDownList();

    if (currentPromiseReject) {
      currentPromiseReject({
        canceled: true
      });
    }

    if (!currentValue) {
      clearButton.classList.remove("visible");
      return false;
    }

    clearButton.classList.add("visible");

    var promise = new Promise((resolve, reject) => {
      currentPromiseReject = reject;

      var apiKey = "823a017cb8cc407fb759b948450fc4fe";
      var url = `https://api.geoapify.com/v1/geocode/autocomplete?text=${encodeURIComponent(currentValue)}&limit=5&apiKey=${apiKey}`;
      
      if (options.type) {
      	url += `&type=${options.type}`;
      }

      fetch(url)
        .then(response => {
          if (response.ok) {
            response.json().then(data => resolve(data));
          } else {
            response.json().then(data => reject(data));
          }
        });
    });

    promise.then((data) => {
      currentItems = data.features;
      var autocompleteItemsElement = document.createElement("div");
      autocompleteItemsElement.setAttribute("class", "autocomplete-items");
      containerElement.appendChild(autocompleteItemsElement);
      data.features.forEach((feature, index) => {
        var itemElement = document.createElement("DIV");
        itemElement.innerHTML = feature.properties.formatted;

        itemElement.addEventListener("click", function(e) {
          inputElement.value = currentItems[index].properties.formatted;

          callback(currentItems[index]);
          closeDropDownList();
        });

        autocompleteItemsElement.appendChild(itemElement);
      });
    }, (err) => {
      if (!err.canceled) {
        console.log(err);
      }
    });
  });

  inputElement.addEventListener("keydown", function(e) {
    var autocompleteItemsElement = containerElement.querySelector(".autocomplete-items");
    if (autocompleteItemsElement) {
      var itemElements = autocompleteItemsElement.getElementsByTagName("div");
      if (e.keyCode == 40) {
        e.preventDefault();
        focusedItemIndex = focusedItemIndex !== itemElements.length - 1 ? focusedItemIndex + 1 : 0;
        setActive(itemElements, focusedItemIndex);
      } else if (e.keyCode == 38) {
        e.preventDefault();
        focusedItemIndex = focusedItemIndex !== 0 ? focusedItemIndex - 1 : focusedItemIndex = (itemElements.length - 1);
        setActive(itemElements, focusedItemIndex);
      } else if (e.keyCode == 13) {

        e.preventDefault();
        if (focusedItemIndex > -1) {
          closeDropDownList();
        }
      }
    } else {
      if (e.keyCode == 40) {
        
        var event = document.createEvent('Event');
        event.initEvent('input', true, true);
        inputElement.dispatchEvent(event);
      }
    }
  });

  function setActive(items, index) {
    if (!items || !items.length) return false;

    for (var i = 0; i < items.length; i++) {
      items[i].classList.remove("autocomplete-active");
    }

    items[index].classList.add("autocomplete-active");

    
    inputElement.value = currentItems[index].properties.formatted;
    callback(currentItems[index]);
  }

  function closeDropDownList() {
    var autocompleteItemsElement = containerElement.querySelector(".autocomplete-items");
    if (autocompleteItemsElement) {
      containerElement.removeChild(autocompleteItemsElement);
    }

    focusedItemIndex = -1;
  }

  function addIcon(buttonElement) {
    var svgElement = document.createElementNS("http://www.w3.org/2000/svg", 'svg');
    svgElement.setAttribute('viewBox', "0 0 24 24");
    svgElement.setAttribute('height', "24");

    var iconElement = document.createElementNS("http://www.w3.org/2000/svg", 'path');
    iconElement.setAttribute("d", "M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z");
    iconElement.setAttribute('fill', 'currentColor');
    svgElement.appendChild(iconElement);
    buttonElement.appendChild(svgElement);
  }
  
  document.addEventListener("click", function(e) {
    if (e.target !== inputElement) {
      closeDropDownList();
    } else if (!containerElement.querySelector(".autocomplete-items")) {
    
      var event = document.createEvent('Event');
      event.initEvent('input', true, true);
      inputElement.dispatchEvent(event);
    }
  });

}

addressAutocomplete(document.getElementById("autocomplete-container"), (data) => {
  console.log("Selected option: ");
  console.log(data);
}, {
	placeholder: "Enter an address here"
});

addressAutocomplete(document.getElementById("autocomplete-container-country"), (data) => {
  console.log("Selected country: ");
  console.log(data);
});
    </script>
    
    <br>
    <footer style="text-align: center;">@2024 Copyright Evento</footer>
</body>

</html>